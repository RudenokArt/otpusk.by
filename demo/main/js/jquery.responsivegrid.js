(function($){var global={defaults:{column:6,gutter:'10px',itemHeight:'100%',itemSelector:'.grid-item',},options:{gridWidth:null,gridHeight:null,gridGutter:null,gridItemWidth:null,gridItemHeight:null,gridMap:[],breakpoints:[],rangeValues:[],currentbreakpoint:{},resizeDelay:180,resizeTimeout:null,},functions:{isPx:function(value){value=value.toLowerCase();if(~value.indexOf('px')){return true;}return false;},isPercent:function(value){value=value.toLowerCase();if(~value.indexOf('%')){return true;}return false;},getPxValue:function(value,size){size_=parseInt(value);if(isNaN(size_)){size_=0;}if(global.functions.isPercent(value)){return Math.floor(size*size_/100);}if(global.functions.isPx(value)){return Math.floor(size_);}return 0;},}};Grid=function(block,settings){this.options={};this.options.grid=$(block);this.init(settings);};Grid.prototype={init:function(settings){var self=this;$.extend(true,this.options,global.options);$.extend(true,this.options,global.defaults);$.extend(true,this.options,settings);$.each(this.options.breakpoints,function(key,breakpoint){breakpoint.condition=self.parseBreakpoint(key,breakpoint.range);});this.resize();$(window).resize(function(){if(self.options.resizeTimeout!==null){clearTimeout(self.options.resizeTimeout);}self.options.resizeTimeout=setTimeout(function(){self.resize();},self.options.resizeDelay);});},resize:function(){var self=this;this.options.resizeTimeout=null;$.each(this.options.breakpoints,function(key,breakpoint){if((breakpoint.condition)(window.innerWidth)){if(breakpoint.range!=self.options.currentbreakpoint.range){self.options.currentbreakpoint=breakpoint;$.extend(true,self.options,breakpoint.options);}}});this.options.grid.css({'position':'relative'});this.options.gridWidth=this.options.grid.width();this.options.gridGutter=global.functions.getPxValue(this.options.gutter,this.options.gridWidth);this.options.gridItemWidth=Math.floor((this.options.gridWidth-(this.options.column-1)*this.options.gridGutter)/this.options.column);this.options.gridItemHeight=global.functions.getPxValue(this.options.itemHeight,this.options.gridItemWidth);this.initMap();this.calculateMap();this.renderGrid();},calculateMap:function(){var self=this;this.options.grid.children(this.options.itemSelector).css({'position':'absolute'}).each(function(k){var colspan=$(this).data('colspan')||1;var rowspan=$(this).data('rowspan')||1;colspan=Math.min(colspan,self.options.column);var added=false;var i,j;for(i=0;i<self.options.gridMap.length;++i){for(j=0;j<self.options.gridMap[i].length;++j){if(self.isFreeMap(i,j,colspan,rowspan)){self.addBlockToMap(i,j,colspan,rowspan,{'block':this,'colspan':colspan,'rowspan':rowspan,});added=true;break;}}if(added){break;}}});},renderGrid:function(){this.removeEmptyRows();this.options.grid.css({'height':this.calculateItemHeight(this.options.gridMap.length),});if(document.body.clientWidth<this.options.gridWidth){this.resize();}var i,j;for(i=0;i<this.options.gridMap.length;++i){for(j=0;j<this.options.gridMap[i].length;++j){if(typeof(this.options.gridMap[i][j])=='object'){$(this.options.gridMap[i][j].block).css({'top':this.calculateItemTop(i),'left':this.calculateItemLeft(j),'width':this.calculateItemWidth(this.options.gridMap[i][j].colspan),'height':this.calculateItemHeight(this.options.gridMap[i][j].rowspan),});}}}},initMap:function(){var length=0;this.options.grid.children(this.options.itemSelector).each(function(){length+=$(this).data('rowspan')||1;});this.options.gridMap=new Array(length);var i;for(i=0;i<this.options.gridMap.length;++i){this.options.gridMap[i]=new Array(this.options.column);}},removeEmptyRows:function(){var i,j;var isFree=null;for(i=0;i<this.options.gridMap.length;++i){isFree=true;for(j=0;j<this.options.gridMap[i].length;++j){if(this.options.gridMap[i][j]!==undefined){isFree=false;break;}}if(isFree){break;}}if(isFree){var length=this.options.gridMap.length-1;for(var k=length;k>=i;--k){this.options.gridMap.pop();}}},isFreeMap:function(i_,j_,colspan,rowspan){var isFree=true;var i,j;if(colspan>this.options.column-j_){isFree=false;}else{for(i=i_;i<i_+rowspan;++i){for(j=j_;j<j_+colspan;++j){if(this.options.gridMap[i][j]!==undefined){isFree=false;break;}}if(!isFree){break;}}}return isFree;},addBlockToMap:function(i_,j_,colspan,rowspan,object){this.options.gridMap[i_][j_]=object;var i,j;for(i=i_;i<i_+rowspan;++i){for(j=j_;j<j_+colspan;++j){if(i!=i_||j!=j_){this.options.gridMap[i][j]=0;}}}},calculateItemWidth:function(colspan){return this.options.gridItemWidth*colspan+this.options.gridGutter*(colspan-1);},calculateItemHeight:function(rowspan){return this.options.gridItemHeight*rowspan+this.options.gridGutter*(rowspan-1);},calculateItemTop:function(row){return(row===0)?0:this.calculateItemHeight(row)+this.options.gridGutter;},calculateItemLeft:function(col){return(col===0)?0:this.calculateItemWidth(col)+this.options.gridGutter;},parseBreakpoint:function(key,range){var self=this;if(typeof range!='string')condition=function(v){return false;};if(range=='*')condition=function(v){return true;};else if(range.charAt(0)=='-'){this.options.rangeValues[key]=parseInt(range.substring(1));condition=function(v){return(v<=self.options.rangeValues[key]);};}else if(range.charAt(range.length-1)=='-'){this.options.rangeValues[key]=parseInt(range.substring(0,range.length-1));condition=function(v){return(v>=self.options.rangeValues[key]);};}else if(~range.indexOf(range,'-')){range=range.split('-');this.options.rangeValues[key]=[parseInt(range[0]),parseInt(range[1])];condition=function(v){return(v>=self.options.rangeValues[key][0]&&v<=self.options.rangeValues[key][1]);};}else{this.options.rangeValues[key]=parseInt(range);condition=function(v){return(v==self.options.rangeValues[key]);};}return condition;},};$.fn.responsivegrid=function(settings){if(typeof settings==='object'){this.each(function(){new Grid(this,settings);});}return this;};})(jQuery);